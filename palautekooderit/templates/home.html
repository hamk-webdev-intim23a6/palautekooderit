{% extends 'base.html' %}
{% block content %}

<h1>Ankkapeli</h1>

{# Display Django messages #}
{% if messages %}
<ul class="messages" style="list-style: none; padding: 0; margin-bottom: 15px;">
  {% for message in messages %}
  {# Basic styling for messages - adjust as needed #}
  <li{% if message.tags %} class="message {{ message.tags }}" style="padding: 10px; margin-bottom: 10px; border-radius: 4px; color: #fff; background-color: {% if 'error' in message.tags %}#dc3545{% elif 'success' in message.tags %}#28a745{% elif 'warning' in message.tags %}#ffc107{% else %}#007bff{% endif %};"{% endif %}>
    {{ message }}
  </li>
  {% endfor %}
</ul>
{% endif %}

{% if user.is_authenticated %}
  {# This is the default state of the form #}
  <div id="button-container" {% if form.is_bound and form.errors %}style="display: none;"{% endif %}>
    <button
      type="button"
      onclick="document.getElementById('feedback-form').style.display='block'; document.getElementById('button-container').style.display='none';"
      style="margin-right: 10px;"
    >
      Anna palautetta
    </button>
    <form method="post" action="{% url 'logout' %}" style="display: inline;">
      {% csrf_token %}
      <button type="submit">Kirjaudu ulos</button>
    </form>
  </div>

  {# The form is hidden by default and shown when the button is clicked #}
  <div id="feedback-form" {% if not form.is_bound or not form.errors %}style="display: none;"{% endif %} style="margin-top: 20px; border: 1px solid #ccc; padding: 15px; border-radius: 5px;">
    <h3>Anna palautetta</h3>
    {% if form.non_field_errors %}
        <div style="color: red; margin-bottom: 10px; border: 1px solid red; padding: 8px; border-radius: 4px;">
            {{ form.non_field_errors }}
        </div>
    {% endif %}

    {# The actual form submission #}
    <form method="post" action="{% url 'submit_feedback' %}">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" style="margin-right: 10px;">Lähetä palaute</button>
      <button
        type="button"
        onclick="document.getElementById('feedback-form').style.display='none'; document.getElementById('button-container').style.display='block';"
      >
        Peruuta
      </button>
    </form>
  </div>

{# If user is not authenticated #}
{% else %}
  <p>Sinun täytyy kirjautua ensin sisään.</p>
  <p><a href="{% url 'login' %}">Kirjaudu sisään</a></p>
  <p><a href="{% url 'signup' %}">Luo uusi tili</a></p>
{% endif %}
{% endblock %}